# 高速公路OD与流量关联分析 - 快速使用指南

## 🚀 快速开始

### 1. 环境准备
```bash
# 设置数据库连接（Windows PowerShell）
$env:DB_HOST="10.149.235.123"
$env:DB_PORT="5432"
$env:DB_NAME="sdzg" 
$env:DB_USER="ln"
$env:DB_PASSWORD="caneln"
```

### 2. 运行分析
```bash
# 进入分析目录
cd 02basedata_process/od_analysis

# 分析1小时数据（推荐）
python detailed_correlation_analysis.py --start-date "2025-07-07 08:00:00" --end-date "2025-07-07 09:00:00"

# 分析30分钟数据（快速测试）
python detailed_correlation_analysis.py --start-date "2025-07-07 08:00:00" --end-date "2025-07-07 08:30:00"
```

### 3. 查看结果
- **HTML报告**：`detailed_correlation_output/detailed_correlation_report.html`
- **详细数据**：`detailed_correlation_output/*.json`

## 📊 关键指标解读

### 门架分析指标
- **途中流量占比**：正常范围90%-95%
- **OD占比**：正常范围5%-10%
- **功能分类**：
  - 通道型（>80%途中流量）：主要承担过境交通
  - 混合型（20%-80%途中流量）：既有起止又有通道功能
  - 起止型（<20%途中流量）：主要作为起止点

### 收费广场分析指标
- **相关系数**：正常范围0.9-1.0（高度一致）
- **OD/流量比**：正常范围45%-55%
- **中位数比例**：约50%为正常现象

## ⚠️ 异常检测

### 需要关注的异常
1. **OD/流量比偏离50%超过20%**
   - 可能原因：设备故障、数据传输问题
   - 处理：检查ETC设备状态

2. **门架途中流量占比低于80%**
   - 可能原因：新增起止点功能
   - 处理：分析交通模式变化

3. **收费广场相关系数低于0.8**
   - 可能原因：数据质量问题
   - 处理：检查数据源一致性

## 🔧 常见问题

### Q1: 脚本运行时间过长
**A**: 减少时间范围或使用样本限制
```bash
python detailed_correlation_analysis.py --start-date "2025-07-07 08:00:00" --end-date "2025-07-07 08:30:00" --sample-size 10000
```

### Q2: 数据库连接失败
**A**: 检查环境变量设置
```bash
echo $env:DB_HOST  # Windows
echo $DB_HOST      # Linux/Mac
```

### Q3: 关联数据为空
**A**: 检查时间范围，确认该时段有数据
```bash
# 选择有数据的时间段
python detailed_correlation_analysis.py --start-date "2025-07-07 08:00:00" --end-date "2025-07-07 09:00:00"
```

## 📈 日常监控建议

### 每日检查
- [ ] 收费广场OD/流量比是否在45%-55%
- [ ] 门架途中流量占比是否在90%-95%
- [ ] 异常收费广场数量是否正常

### 每周分析
- [ ] 门架功能分类变化趋势
- [ ] 收费广场相关系数稳定性
- [ ] 数据质量改进效果

### 异常处理
1. **立即处理**：相关系数<0.8，OD/流量比偏离>30%
2. **优先处理**：途中流量占比异常，流量平衡严重偏离
3. **定期处理**：轻微的数据质量问题

## 📋 输出文件说明

| 文件名 | 内容 | 用途 |
|--------|------|------|
| `detailed_correlation_report.html` | 完整分析报告 | 查看总体结果 |
| `gantry_transit_analysis.json` | 门架途中流量分析 | 门架功能评估 |
| `toll_square_median_entry_analysis.json` | 中位数案例分析 | 差异原因调查 |
| `toll_square_balance_analysis.json` | 流量平衡分析 | 异常收费广场识别 |

## 🎯 核心结论

1. **门架主要承担通道功能**：93.7%途中流量占比
2. **收费广场高度一致**：0.953相关系数
3. **50%差异属正常现象**：由OD数据采样不完整导致
4. **数据质量可控**：建立了科学的评估体系

---
*更多详细信息请参考《高速公路OD与流量关联分析总结报告.md》*
